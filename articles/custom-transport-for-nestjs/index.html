<html lang="ru"><head><title>Trejgun's blog</title><meta charset="utf-8"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="description" name="description"><meta content="keywords" name="keywords"><meta content="all" name="robots"><meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"><link href="/favicon.ico" rel="icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://unpkg.com" rel="preconnect"><style type="text/css"></style><style data-jss="" data-meta="MuiPaper">.MuiPaper-root{color:rgba(0,0,0,.87);transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 1px 5px 0 rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 1px 8px 0 rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}</style><style data-jss="" data-meta="MuiAppBar">.MuiAppBar-root{width:100%;display:flex;z-index:1100;box-sizing:border-box;flex-shrink:0;flex-direction:column}.MuiAppBar-positionFixed{top:0;left:auto;right:0;position:fixed}.MuiAppBar-positionAbsolute{top:0;left:auto;right:0;position:absolute}.MuiAppBar-positionSticky{top:0;left:auto;right:0;position:sticky}.MuiAppBar-positionStatic{position:static}.MuiAppBar-positionRelative{position:relative}.MuiAppBar-colorDefault{color:rgba(0,0,0,.87);background-color:#f5f5f5}.MuiAppBar-colorPrimary{color:#fff;background-color:#3f51b5}.MuiAppBar-colorSecondary{color:#fff;background-color:#f50057}</style><style data-jss="" data-meta="MuiTypography">.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1.1428571428571428rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.8571428571428571rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6.857142857142857rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1;letter-spacing:-.01562em}.MuiTypography-h2{font-size:4.285714285714286rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.04;letter-spacing:0}.MuiTypography-h4{font-size:2.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.17;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.7142857142857142rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.33;letter-spacing:0}.MuiTypography-h6{font-size:1.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1.1428571428571428rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.8571428571428571rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#3f51b5}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}</style><style data-jss="" data-meta="MuiContainer">.MuiContainer-root{width:100%;box-sizing:border-box;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiContainer-root{padding-left:24px;padding-right:24px}}@media (min-width:960px){.MuiContainer-root{padding-left:32px;padding-right:32px}}@media (min-width:600px){.MuiContainer-fixed{max-width:600px}}@media (min-width:960px){.MuiContainer-fixed{max-width:960px}}@media (min-width:1280px){.MuiContainer-fixed{max-width:1280px}}@media (min-width:1920px){.MuiContainer-fixed{max-width:1920px}}@media (min-width:0px){.MuiContainer-maxWidthXs{max-width:444px}}@media (min-width:600px){.MuiContainer-maxWidthSm{max-width:600px}}@media (min-width:960px){.MuiContainer-maxWidthMd{max-width:960px}}@media (min-width:1280px){.MuiContainer-maxWidthLg{max-width:1280px}}@media (min-width:1920px){.MuiContainer-maxWidthXl{max-width:1920px}}</style><style data-jss="" data-meta="MuiCssBaseline">html{box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:inherit}b,strong{font-weight:bolder}body{color:rgba(0,0,0,.87);margin:0;font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em;background-color:#fafafa}@media print{body{background-color:#fff}}body::backdrop{background-color:#fafafa}</style><style data-jss="" data-meta="MuiLink">.MuiLink-underlineNone{text-decoration:none}.MuiLink-underlineHover{text-decoration:none}.MuiLink-underlineHover:hover{text-decoration:underline}.MuiLink-underlineAlways{text-decoration:underline}.MuiLink-button{border:0;cursor:pointer;margin:0;outline:0;padding:0;position:relative;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiLink-button::-moz-focus-inner{border-style:none}.MuiLink-button.Mui-focusVisible{outline:auto}</style><style data-jss="" data-meta="MuiToolbar">.MuiToolbar-root{display:flex;position:relative;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}</style><style data-jss="" data-meta="Header">.jss3{background-color:#3c75e6}.jss4{min-height:64px}.jss5{flex-grow:1}.jss6{color:#fff;font-size:36px;font-weight:500;text-decoration:none}.jss6:hover{text-decoration:none}.jss7{width:62px;height:40px;display:inline-block;margin-right:8px;vertical-align:middle}</style><style data-jss="" data-meta="Layout">.jss1{display:flex;position:relative;min-height:100vh;overflow-x:hidden;overflow-y:auto}.jss2{padding-top:80px;padding-left:16px;padding-right:16px}@media (min-width:600px){.jss2{padding-left:24px;padding-right:24px}}</style><style data-jss="" data-meta="MyDate">.jss91{color:silver;float:right}</style><link href="https://connect.facebook.net" rel="preconnect"><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:0 0;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande",tahoma,verdana,arial,sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:400;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}.fb_dialog{background:rgba(82,82,82,.7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:700;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) #fff no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:0 0;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:0 0}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0,0,0,.4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba),to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:#fff 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica,sans-serif;text-overflow:ellipsis;text-shadow:rgba(0,30,84,.296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267b2),to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:0 0;border:none;color:#fff;font:bold 12px Helvetica,sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0,30,84,.296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:700;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0,30,84,.296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop iframe,.fb_iframe_widget_fluid_desktop span{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}</style><link href="https://staticxx.facebook.com" rel="preconnect"><link href="https://www.facebook.com" rel="preconnect"></head><body><div id="app"><div class="jss1"><header class="MuiPaper-root MuiPaper-elevation4 MuiAppBar-root MuiAppBar-positionFixed jss3 MuiAppBar-colorPrimary mui-fixed"><div class="MuiToolbar-root MuiToolbar-regular jss4 MuiToolbar-gutters"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss6 MuiTypography-colorPrimary" href="/"></a><div class="jss5"></div></div></header><div class="MuiContainer-root jss2 MuiContainer-maxWidthMd"><div><div class="jss91">2019-10-25</div><h2 class="MuiTypography-root MuiTypography-h4">Custom Transport for Nest.js</h2><p>Yesterday I tried to implement <em>CustomTransportStrategy</em> for Nest.js and after googling for half an hour I realize there are only examples for RabbitMQ like this <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiTypography-colorPrimary" href="https://github.com/AlariCode/nestjs-rmq" rel="noopener noreferrer nofollow" target="_blank">nestjs-rmq</a>, which is already included in <em>@nestjs/microservice</em> package. But there were nothing simple where one can see a logic related only to Nest.js itself until now</p><p>For this example I will implement simple <em>EventEmitter</em> using setInterval, which emits timestamp each second, but in real life it could be anything like TCP calls, queue in any kind of SQL/NOSQL database, ZeroMQ, AWS SQS or Google pub/sub</p><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code><span style="font-weight:700;color:navy">import</span> {EventEmitter} <span style="font-weight:700;color:navy">from</span> <span style="color:green;font-weight:700">"events"</span>;


<span style="font-weight:700;color:navy">export</span> <span style="font-weight:700;color:navy">class</span> Ticker <span style="font-weight:700;color:navy">extends</span> EventEmitter {
  <span style="font-weight:700;color:navy">private</span> intervalId: NodeJS.Timeout | <span style="font-weight:700;color:navy">null</span> = <span style="font-weight:700;color:navy">null</span>;

  start(): <span class="hljs-built_in">void</span> {
    <span style="font-weight:700;color:navy">this</span>.intervalId = setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
      <span style="font-weight:700;color:navy">this</span>.emit(<span style="color:green;font-weight:700">"data"</span>, <span class="hljs-built_in">Date</span>.now());
    }, <span style="font-weight:400;color:#00f">1000</span>);
  }

  stop(): <span class="hljs-built_in">void</span> {
    <span style="font-weight:700;color:navy">if</span> (<span style="font-weight:700;color:navy">this</span>.intervalId) {
      clearInterval(<span style="font-weight:700;color:navy">this</span>.intervalId);
    }
  }
}
</code></pre><p>Now a listener should be attached to listen to this <em>Ticker</em> events (timestamp) and pass them to corresponding handler. For this I have to implement only two methods <em>listen</em> and <em>close</em>.</p><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code><span style="font-weight:700;color:navy">import</span> {Server, CustomTransportStrategy, MessageHandler} <span style="font-weight:700;color:navy">from</span> <span style="color:green;font-weight:700">"@nestjs/microservices"</span>;
<span style="font-weight:700;color:navy">import</span> {Ticker} <span style="font-weight:700;color:navy">from</span> <span style="color:green;font-weight:700">"./ticker"</span>;


<span style="font-weight:700;color:navy">export</span> <span style="font-weight:700;color:navy">class</span> TickerServer <span style="font-weight:700;color:navy">extends</span> Server <span style="font-weight:700;color:navy">implements</span> CustomTransportStrategy {
  <span style="font-weight:700;color:navy">private</span> ticker: Ticker;

  <span style="font-weight:700;color:navy">public</span> listen(callback: <span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span style="font-weight:700;color:navy">this</span>.ticker = <span style="font-weight:700;color:navy">new</span> Ticker();
    <span style="font-weight:700;color:navy">this</span>.ticker.start();
    <span style="font-weight:700;color:navy">this</span>.ticker.on(<span style="color:green;font-weight:700">"data"</span>, <span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">number</span></span>) =></span> {
      <span style="font-weight:700;color:navy">this</span>.listener(e);
    });
    callback();
  }

  <span style="font-weight:700;color:navy">public</span> <span style="font-weight:700;color:navy">async</span> listener(e: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>> {
    <span style="font-weight:700;color:navy">const</span> handler: MessageHandler | <span style="font-weight:700;color:navy">undefined</span> = <span style="font-weight:700;color:navy">this</span>.messageHandlers.get(<span style="color:green;font-weight:700">"TICK"</span>);
    <span style="font-weight:700;color:navy">if</span> (!handler) {
      <span style="font-weight:700;color:navy">return</span>;
    }
    <span style="font-weight:700;color:navy">const</span> result = <span style="font-weight:700;color:navy">await</span> handler(e);
    <span class="hljs-built_in">console</span>.log(result);
  }

  <span style="font-weight:700;color:navy">public</span> close(): <span class="hljs-built_in">void</span> {
    <span style="font-weight:700;color:navy">this</span>.ticker.stop();
  }
}
</code></pre><p>But the docs are silent about how to path event to controller. Event listeners of all controllers are stored in<em>messageHandlers</em> property. It also looks like it makes no sense to path object as event pattern because it is just stringified.</p><p>Finally here is a controller to handle <em>TICK</em> message, it is dead simple. The value returned from controller can be used to remove message from queue.</p><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code><span style="font-weight:700;color:navy">import</span> {Controller} <span style="font-weight:700;color:navy">from</span> <span style="color:green;font-weight:700">"@nestjs/common"</span>;
<span style="font-weight:700;color:navy">import</span> {MessagePattern} <span style="font-weight:700;color:navy">from</span> <span style="color:green;font-weight:700">"@nestjs/microservices"</span>;

<span style="color:olive">@Controller</span>()
<span style="font-weight:700;color:navy">export</span> <span style="font-weight:700;color:navy">class</span> TickerController {
  <span style="color:olive">@MessagePattern</span>(<span style="color:green;font-weight:700">"TICK"</span>)
  <span style="font-weight:700;color:navy">public</span> ticker(data: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">number</span>> {
    <span style="font-weight:700;color:navy">return</span> <span class="hljs-built_in">Promise</span>.resolve(data);
  }
}
</code></pre><p>This is all for today, good luck with your code!</p><div><div class="fb-comments fb_iframe_widget fb_iframe_widget_fluid_desktop" data-href="https://trejgun.github.io/articles/custom-transport-for-nestjs" fb-iframe-plugin-query="app_id=471903663420767&container_width=448&height=100&href=https%3A%2F%2Ftrejgun.github.io%2Farticles%2Fcustom-transport-for-nestjs&locale=en_US&sdk=joey&version=v3.1&width=550" fb-xfbml-state="rendered"><span style="vertical-align:bottom;width:550px;height:188px"><iframe allow="encrypted-media" allowfullscreen allowtransparency="true" frameborder="0" name="f199beb0951585" scrolling="no" src="https://www.facebook.com/v3.1/plugins/comments.php?app_id=471903663420767&channel=https%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D44%23cb%3Df2a9f1fb01bcc48%26domain%3Dlocalhost%26origin%3Dhttp%253A%252F%252Flocalhost%253A45678%252Ff53eb6d3c19018%26relation%3Dparent.parent&container_width=448&height=100&href=https%3A%2F%2Ftrejgun.github.io%2Farticles%2Fcustom-transport-for-nestjs&locale=en_US&sdk=joey&version=v3.1&width=550" style="border:none;visibility:visible;width:550px;height:188px" title="fb:comments Facebook Social Plugin" class="" height="100px" width="550px"></iframe></span></div></div></div></div></div></div><script src="https://connect.facebook.net/en_US/sdk.js?hash=600b8d8175a500ed7391f8b21659f8b3" crossorigin="anonymous" async></script><script src="https://unpkg.com/react@16.9.0/umd/react.production.min.js" crossorigin="anonymous" type="text/javascript"></script><script src="https://unpkg.com/react-dom@16.9.0/umd/react-dom.production.min.js" crossorigin="anonymous" type="text/javascript"></script><script src="https://unpkg.com/@material-ui/core@4.4.3/umd/material-ui.production.min.js" crossorigin="anonymous" type="text/javascript"></script><script src="/dist/bundle/vendors.js" crossorigin="anonymous" type="text/javascript"></script><script src="/dist/bundle/main.js" crossorigin="anonymous" type="text/javascript"></script><script src="https://connect.facebook.net/en_US/sdk.js" async defer id="facebook-jssdk"></script><div class="fb_reset" id="fb-root"><div style="position:absolute;top:-10000px;width:0;height:0"><div></div><div><iframe allow="encrypted-media" allowfullscreen allowtransparency="true" frameborder="0" name="fb_xdm_frame_https" scrolling="no" src="https://staticxx.facebook.com/connect/xd_arbiter.php?version=44#channel=f53eb6d3c19018&origin=http%3A%2F%2Flocalhost%3A45678" style="border:none" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" tabindex="-1"></iframe></div></div></div></body></html>