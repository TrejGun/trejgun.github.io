<html lang="ru"><head><title>Trejgun's blog</title><meta charset="utf-8"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="There are no problems only opportunities" name="description"><meta content="nextjs material-ui graphql react" name="keywords"><meta content="all" name="robots"><meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"><link href="/favicon.ico" rel="icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://unpkg.com" rel="preconnect"><style data-jss="" data-meta="MuiPaper">.MuiPaper-root{color:rgba(0,0,0,.87);transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-outlined{border:1px solid rgba(0,0,0,.12)}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}</style><style data-jss="" data-meta="MuiAppBar">.MuiAppBar-root{width:100%;display:flex;z-index:1100;box-sizing:border-box;flex-shrink:0;flex-direction:column}.MuiAppBar-positionFixed{top:0;left:auto;right:0;position:fixed}@media print{.MuiAppBar-positionFixed{position:absolute}}.MuiAppBar-positionAbsolute{top:0;left:auto;right:0;position:absolute}.MuiAppBar-positionSticky{top:0;left:auto;right:0;position:sticky}.MuiAppBar-positionStatic{position:static;transform:translateZ(0)}.MuiAppBar-positionRelative{position:relative}.MuiAppBar-colorDefault{color:rgba(0,0,0,.87);background-color:#f5f5f5}.MuiAppBar-colorPrimary{color:#fff;background-color:#3f51b5}.MuiAppBar-colorSecondary{color:#fff;background-color:#f50057}.MuiAppBar-colorInherit{color:inherit}.MuiAppBar-colorTransparent{color:inherit;background-color:transparent}</style><style data-jss="" data-meta="MuiTypography">.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1.1428571428571428rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.8571428571428571rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6.857142857142857rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.167;letter-spacing:-.01562em}.MuiTypography-h2{font-size:4.285714285714286rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.2;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.167;letter-spacing:0}.MuiTypography-h4{font-size:2.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.235;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.7142857142857142rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.334;letter-spacing:0}.MuiTypography-h6{font-size:1.4285714285714284rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1.1428571428571428rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.8571428571428571rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#3f51b5}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}</style><style data-jss="" data-meta="MuiContainer">.MuiContainer-root{width:100%;display:block;box-sizing:border-box;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiContainer-root{padding-left:24px;padding-right:24px}}.MuiContainer-disableGutters{padding-left:0;padding-right:0}@media (min-width:600px){.MuiContainer-fixed{max-width:600px}}@media (min-width:960px){.MuiContainer-fixed{max-width:960px}}@media (min-width:1280px){.MuiContainer-fixed{max-width:1280px}}@media (min-width:1920px){.MuiContainer-fixed{max-width:1920px}}@media (min-width:0px){.MuiContainer-maxWidthXs{max-width:444px}}@media (min-width:600px){.MuiContainer-maxWidthSm{max-width:600px}}@media (min-width:960px){.MuiContainer-maxWidthMd{max-width:960px}}@media (min-width:1280px){.MuiContainer-maxWidthLg{max-width:1280px}}@media (min-width:1920px){.MuiContainer-maxWidthXl{max-width:1920px}}</style><style data-jss="" data-meta="MuiCssBaseline">html{box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:inherit}b,strong{font-weight:700}body{color:rgba(0,0,0,.87);margin:0;font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em;background-color:#fafafa}@media print{body{background-color:#fff}}body::backdrop{background-color:#fafafa}</style><style data-jss="" data-meta="MuiLink">.MuiLink-underlineNone{text-decoration:none}.MuiLink-underlineHover{text-decoration:none}.MuiLink-underlineHover:hover{text-decoration:underline}.MuiLink-underlineAlways{text-decoration:underline}.MuiLink-button{border:0;cursor:pointer;margin:0;outline:0;padding:0;position:relative;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiLink-button::-moz-focus-inner{border-style:none}.MuiLink-button.Mui-focusVisible{outline:auto}</style><style data-jss="" data-meta="MuiToolbar">.MuiToolbar-root{display:flex;position:relative;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}</style><style data-jss="" data-meta="Header">.jss3{background-color:#3c75e6}.jss4{min-height:64px}.jss5{flex-grow:1}.jss6{color:#fff;font-size:36px;font-weight:500;text-decoration:none}.jss6:hover{text-decoration:none}.jss7{width:62px;height:40px;display:inline-block;margin-right:8px;vertical-align:middle}</style><style data-jss="" data-meta="Layout">.jss1{display:flex;position:relative;min-height:100vh;overflow-x:hidden;overflow-y:auto}.jss2{padding-top:80px;padding-left:16px;padding-right:16px}@media (min-width:600px){.jss2{padding-left:24px;padding-right:24px}}.jss2 p *{padding-left:5px;padding-right:5px}</style><style data-jss="" data-meta="MyDate">.jss95{color:silver;float:right}</style><link href="https://fonts.gstatic.com" rel="preconnect"></head><body><div id="app"><div class="jss1"><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed MuiAppBar-colorPrimary jss3 mui-fixed MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular jss4 MuiToolbar-gutters"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss6 MuiTypography-colorPrimary" href="/"></a><div class="jss5"></div></div></header><div class="MuiContainer-root jss2 MuiContainer-maxWidthMd"><div><div class="jss95">2020-06-05</div><h2 class="MuiTypography-root MuiTypography-h4">S3 Module for Nest.js</h2><p>I was working with S3 recently and want to share my solution.</p><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code class="language-typescript"><span style="font-weight:700;color:navy">import</span><span> {Module} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"@nestjs/common"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {S3} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"aws-sdk"</span><span>;
</span>
<span></span><span style="font-weight:700;color:navy">import</span><span> {S3Controller} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.controller"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {S3Service} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.service"</span><span>;
</span>
<span></span><span style="color:olive">@Module</span><span>({
</span>  controllers: [S3Controller],
  providers: [
    S3Service,
    {
<span>      provide: </span><span style="color:green;font-weight:700">"s3"</span><span>,
</span><span>      useValue: </span><span style="font-weight:700;color:navy">new</span><span> S3(),
</span>    },
  ],
<span>  </span><span class="hljs-built_in">exports</span><span>: [S3Service],
</span>})
<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">class</span><span> S3Module {}
</span>
</code></pre><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code class="language-typescript"><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">interface</span><span> IS3PutFields {
</span><span>  objectName: </span><span class="hljs-built_in">string</span><span>;
</span><span>  contentType: </span><span class="hljs-built_in">string</span><span>;
</span>}

<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">interface</span><span> IS3DeleteFields {
</span><span>  objectName: </span><span class="hljs-built_in">string</span><span>;
</span>}

<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">interface</span><span> IS3GetFields {
</span><span>  objectName: </span><span class="hljs-built_in">string</span><span>;
</span>}

<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">interface</span><span> IS3Result {
</span><span>  signedUrl: </span><span class="hljs-built_in">string</span><span>;
</span>}

</code></pre><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code class="language-typescript"><span style="font-weight:700;color:navy">import</span><span> {ApiProperty} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"@nestjs/swagger"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {IsNotEmpty, IsString} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"class-validator"</span><span>;
</span>
<span></span><span style="font-weight:700;color:navy">import</span><span> {IS3DeleteFields, IS3PutFields} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"../s3.types"</span><span>;
</span>

<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">class</span><span> S3DeleteSchema </span><span style="font-weight:700;color:navy">implements</span><span> IS3DeleteFields {
</span><span>  </span><span style="color:olive">@ApiProperty</span><span>()
</span><span>  </span><span style="color:olive">@IsNotEmpty</span><span>()
</span><span>  </span><span style="color:olive">@IsString</span><span>()
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> objectName: </span><span class="hljs-built_in">string</span><span>;
</span>}


<span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">class</span><span> S3PutSchema </span><span style="font-weight:700;color:navy">implements</span><span> IS3PutFields {
</span><span>  </span><span style="color:olive">@ApiProperty</span><span>()
</span><span>  </span><span style="color:olive">@IsNotEmpty</span><span>()
</span><span>  </span><span style="color:olive">@IsString</span><span>()
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> objectName: </span><span class="hljs-built_in">string</span><span>;
</span>
<span>  </span><span style="color:olive">@ApiProperty</span><span>()
</span><span>  </span><span style="color:olive">@IsNotEmpty</span><span>()
</span><span>  </span><span style="color:olive">@IsString</span><span>()
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> contentType: </span><span class="hljs-built_in">string</span><span>;
</span>}

</code></pre><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code class="language-typescript"><span style="font-weight:700;color:navy">import</span><span> {Controller, Get, Query} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"@nestjs/common"</span><span>;
</span>
<span></span><span style="font-weight:700;color:navy">import</span><span> {S3PutSchema, S3DeleteSchema} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.schemas"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {S3Service} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.service"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {IS3Result} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.types"</span><span>;
</span>
<span></span><span style="color:olive">@Controller</span><span>(</span><span style="color:green;font-weight:700">"s3"</span><span>)
</span><span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">class</span><span> S3Controller {
</span><span>  </span><span style="font-weight:700;color:navy">constructor</span><span>(</span><span style="font-weight:700;color:navy" class="hljs-params">private</span><span class="hljs-params"> </span><span style="font-weight:700;color:navy" class="hljs-params">readonly</span><span class="hljs-params"> s3Service: S3Service</span><span>) {}
</span>
<span>  </span><span style="color:olive">@Get</span><span>(</span><span style="color:green;font-weight:700">"/put"</span><span>)
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> putObject(</span><span style="color:olive">@Query</span><span>() data: S3PutSchema): </span><span class="hljs-built_in">Promise</span><span>&lt;IS3Result> {
</span><span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3Service.putObject(data);
</span>  }

<span>  </span><span style="color:olive">@Get</span><span>(</span><span style="color:green;font-weight:700">"/get"</span><span>)
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> getObject(</span><span style="color:olive">@Query</span><span>() data: S3PutSchema): </span><span class="hljs-built_in">Promise</span><span>&lt;IS3Result> {
</span><span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3Service.getObject(data);
</span>  }

<span>  </span><span style="color:olive">@Get</span><span>(</span><span style="color:green;font-weight:700">"/delete"</span><span>)
</span><span>  </span><span style="font-weight:700;color:navy">public</span><span> deleteObject(</span><span style="color:olive">@Query</span><span>() data: S3DeleteSchema): </span><span class="hljs-built_in">Promise</span><span>&lt;</span><span class="hljs-built_in">any</span><span>> {
</span><span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3Service.deleteObject(data);
</span>  }
}

</code></pre><pre style="display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff"><code class="language-typescript"><span style="font-weight:700;color:navy">import</span><span> {Inject, Injectable} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"@nestjs/common"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {v4} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"uuid"</span><span>;
</span><span></span><span style="font-weight:700;color:navy">import</span><span> {S3} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"aws-sdk"</span><span>;
</span>
<span></span><span style="font-weight:700;color:navy">import</span><span> {IS3DeleteFields, IS3GetFields, IS3PutFields, IS3Result} </span><span style="font-weight:700;color:navy">from</span><span> </span><span style="color:green;font-weight:700">"./s3.types"</span><span>;
</span>
<span></span><span style="color:olive">@Injectable</span><span>()
</span><span></span><span style="font-weight:700;color:navy">export</span><span> </span><span style="font-weight:700;color:navy">class</span><span> S3Service {
</span><span>  </span><span style="font-weight:700;color:navy">constructor</span><span>(</span><span class="hljs-params">
</span><span class="hljs-params">    </span><span style="color:olive" class="hljs-params">@Inject</span><span class="hljs-params">(</span><span style="color:green;font-weight:700" class="hljs-params">"s3"</span><span class="hljs-params">)
</span><span class="hljs-params">    </span><span style="font-weight:700;color:navy" class="hljs-params">private</span><span class="hljs-params"> </span><span style="font-weight:700;color:navy" class="hljs-params">readonly</span><span class="hljs-params"> s3: S3,
</span><span class="hljs-params">  </span><span>) {}
</span>
<span>  getObject({objectName}: IS3GetFields): </span><span class="hljs-built_in">Promise</span><span>&lt;IS3Result> {
</span><span>    </span><span style="font-weight:700;color:navy">const</span><span> params = {
</span>      Bucket: process.env.AWS_S3_BUCKET,
      Key: objectName,
    };

<span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3.getSignedUrlPromise(</span><span style="color:green;font-weight:700">"getObject"</span><span>, params).then(</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">signedUrl: </span><span class="hljs-function hljs-params hljs-built_in">string</span><span class="hljs-function">) =></span><span> ({
</span>      signedUrl,
    }));
  }

<span>  putObject({contentType}: IS3PutFields): </span><span class="hljs-built_in">Promise</span><span>&lt;IS3Result> {
</span><span>    </span><span style="font-weight:700;color:navy">const</span><span> filename = </span><span style="color:green;font-weight:700">`</span><span style="color:#000;font-weight:400">${v4()}</span><span style="color:green;font-weight:700">.</span><span style="color:#000;font-weight:400">${contentType.split(</span><span style="color:green;font-weight:700">"/"</span><span style="color:#000;font-weight:400">)[</span><span style="color:#00f;font-weight:400">0</span><span style="color:#000;font-weight:400">]}</span><span style="color:green;font-weight:700">`</span><span>;
</span>
<span>    </span><span style="font-weight:700;color:navy">const</span><span> params = {
</span>      Bucket: process.env.AWS_S3_BUCKET_NAME,
      Key: filename,
<span>      Expires: </span><span style="font-weight:400;color:#00f">60</span><span>,
</span>      ContentType: contentType,
<span>      ACL: </span><span style="color:green;font-weight:700">"public-read"</span><span>,
</span>    };

<span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3.getSignedUrlPromise(</span><span style="color:green;font-weight:700">"putObject"</span><span>, params).then(</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">signedUrl: </span><span class="hljs-function hljs-params hljs-built_in">string</span><span class="hljs-function">) =></span><span> ({
</span>      signedUrl,
    }));
  }

<span>  deleteObject({objectName}: IS3DeleteFields): </span><span class="hljs-built_in">Promise</span><span>&lt;</span><span class="hljs-built_in">any</span><span>> {
</span><span>    </span><span style="font-weight:700;color:navy">const</span><span> params = {
</span>      Bucket: process.env.AWS_S3_BUCKET_NAME,
      Key: objectName,
    };

<span>    </span><span style="font-weight:700;color:navy">return</span><span> </span><span class="hljs-built_in">this</span><span>.s3.deleteObject(params).promise();
</span>  }
}

</code></pre><p>Amazon is fucking expensive and over complicated. Just saying.</p></div></div></div></div><script crossorigin="anonymous" src="https://unpkg.com/react@17.0.1/umd/react.production.min.js" type="text/javascript"></script><script crossorigin="anonymous" src="https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js" type="text/javascript"></script><script crossorigin="anonymous" src="https://unpkg.com/@material-ui/core@4.9.9/umd/material-ui.production.min.js" type="text/javascript"></script><script crossorigin="anonymous" src="/dist/bundle/vendors.js" type="text/javascript"></script><script crossorigin="anonymous" src="/dist/bundle/main.js" type="text/javascript"></script></body></html>